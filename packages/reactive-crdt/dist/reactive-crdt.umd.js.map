{"version":3,"file":"reactive-crdt.umd.js","sources":["../src/boxed.ts","../src/types.ts","../src/internal.ts","../src/object.ts","../src/index.ts","../src/array.ts","../src/index.ts"],"sourcesContent":["import { JSONValue } from \"./types\";\r\nimport * as Y from \"yjs\";\r\n\r\n// const RAW_SYMBOL = Symbol(\"bo\");\r\nexport class Box<T extends Readonly<JSONValue>> {\r\n  // public RAW_SYMBOL;\r\n  constructor(public readonly value: T) {}\r\n}\r\n\r\nexport function boxed<T extends JSONValue>(value: T) {\r\n  return new Box(Object.freeze(value) as T);\r\n}\r\n","import * as Y from \"yjs\";\r\n\r\nexport type Primitive = bigint | boolean | null | number | string | symbol | undefined;\r\n\r\nexport type JSONValue = Primitive | JSONObject | JSONArray;\r\n\r\nexport type JSONObject = {\r\n  [key: string]: JSONValue;\r\n};\r\n\r\nexport type JSONArray = Array<JSONValue>;\r\n\r\nexport function isYType(element: any) {\r\n  return element instanceof Y.AbstractType;\r\n}\r\n","import { markRaw } from \"@reactivedata/reactive\";\r\nimport * as Y from \"yjs\";\r\nimport { crdtValue } from \".\";\r\nimport { boxed } from \"./boxed\";\r\nimport { isYType } from \"./types\";\r\nexport const yToWrappedCache = new WeakMap<Y.AbstractType<any>, any>();\r\n\r\nexport function parseYjsReturnValue(value: any, implicitObserver?: any) {\r\n  if (isYType(value)) {\r\n    value._implicitObserver = implicitObserver;\r\n\r\n    if (value instanceof Y.Array || value instanceof Y.Map) {\r\n      if (!yToWrappedCache.has(value)) {\r\n        const wrapped = crdtValue(value, null);\r\n        yToWrappedCache.set(value, wrapped);\r\n      }\r\n      value = yToWrappedCache.get(value);\r\n    } else if (\r\n      value instanceof Y.XmlElement ||\r\n      value instanceof Y.XmlFragment ||\r\n      value instanceof Y.XmlText ||\r\n      value instanceof Y.XmlHook ||\r\n      value instanceof Y.Text\r\n    ) {\r\n      markRaw(value);\r\n      (value as any).__v_skip = true; // for vue Reactive\r\n    } else {\r\n      throw new Error(\"unknown YType\");\r\n    }\r\n    return value;\r\n  } else if (typeof value === \"object\") {\r\n    return boxed(value);\r\n  }\r\n  return value;\r\n}\r\n","import { $reactive, $reactiveproxy, reactive } from \"@reactivedata/reactive\";\r\nimport * as Y from \"yjs\";\r\nimport { crdtValue, getInternalAny, INTERNAL_SYMBOL, ObjectSchemaType } from \".\";\r\nimport { CRDTArray } from \"./array\";\r\nimport { parseYjsReturnValue, yToWrappedCache } from \"./internal\";\r\nimport { Box } from \"./boxed\";\r\nimport { isYType } from \"./types\";\r\n\r\nexport type CRDTObject<T extends ObjectSchemaType> = {\r\n  [P in keyof T]?: T[P] extends Box<infer A>\r\n    ? Box<A>\r\n    : T[P] extends Array<infer A>\r\n    ? CRDTArray<A>\r\n    : T[P] extends ObjectSchemaType\r\n    ? CRDTObject<T[P]>\r\n    : T[P];\r\n} & {\r\n  [INTERNAL_SYMBOL]?: Y.Map<T>;\r\n};\r\n\r\nexport function crdtObject<T extends ObjectSchemaType>(initializer: T, map = new Y.Map<any>()) {\r\n  if (map[$reactive]) {\r\n    throw new Error(\"unexpected\");\r\n    // map = map[$reactive].raw;\r\n  }\r\n\r\n  const proxy = new Proxy(({} as any) as CRDTObject<T>, {\r\n    set: (target, p, value) => {\r\n      if (typeof p !== \"string\") {\r\n        throw new Error();\r\n      }\r\n      const wrapped = crdtValue(value, map); // TODO: maybe set cache\r\n      const internal = getInternalAny(wrapped) || wrapped;\r\n      if (internal instanceof Box) {\r\n        map.set(p, internal.value);\r\n      } else {\r\n        map.set(p, internal);\r\n      }\r\n      return true;\r\n    },\r\n    get: (target, p, receiver) => {\r\n      if (p === INTERNAL_SYMBOL) {\r\n        return map;\r\n      }\r\n      if (typeof p !== \"string\") {\r\n        return Reflect.get(target, p);\r\n        // throw new Error(\"get non string parameter\");\r\n      }\r\n      let ic: any;\r\n      if (receiver && receiver[$reactiveproxy]) {\r\n        ic = receiver[$reactiveproxy]?.implicitObserver;\r\n        (map as any)._implicitObserver = ic;\r\n      } else {\r\n        // console.warn(\"no receiver getting property\", p);\r\n      }\r\n      let ret = map.get(p);\r\n      ret = parseYjsReturnValue(ret, ic);\r\n      return ret;\r\n    },\r\n    deleteProperty: (target, p) => {\r\n      if (typeof p !== \"string\") {\r\n        throw new Error();\r\n      }\r\n      if (map.has(p)) {\r\n        map.delete(p);\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    },\r\n    has: (target, p) => {\r\n      if (typeof p === \"string\" && map.has(p)) {\r\n        return true;\r\n      }\r\n      return false;\r\n    },\r\n    getOwnPropertyDescriptor(target, p) {\r\n      if (typeof p === \"string\" && map.has(p)) {\r\n        return {\r\n          enumerable: true,\r\n          configurable: true\r\n        };\r\n      }\r\n      return undefined;\r\n    },\r\n    ownKeys: target => {\r\n      return Array.from(map.keys());\r\n    }\r\n  });\r\n\r\n  yToWrappedCache.set(map, proxy);\r\n\r\n  for (let key in initializer) {\r\n    proxy[key] = initializer[key] as any;\r\n  }\r\n\r\n  return proxy;\r\n}\r\n","import * as reactive from \"@reactivedata/reactive\";\r\nimport { makeYJSObservable, useReactiveBindings } from \"@reactivedata/yjs-reactive-bindings\";\r\nimport * as Y from \"yjs\";\r\nimport { CRDTArray, crdtArray } from \"./array\";\r\nimport { CRDTObject, crdtObject } from \"./object\";\r\nimport { Box } from \"./boxed\";\r\nimport { JSONValue } from \"./types\";\r\nexport { useMobxBindings, useVueBindings } from \"@reactivedata/yjs-reactive-bindings\";\r\n\r\n// setup yjs-reactive-bindings\r\nmakeYJSObservable();\r\nuseReactiveBindings(reactive); // use reactive bindings by default\r\n\r\nexport const INTERNAL_SYMBOL = Symbol(\"INTERNAL_SYMBOL\");\r\n\r\nexport function getInternalMap<T extends ObjectSchemaType>(object: CRDTObject<T>) {\r\n  return object[INTERNAL_SYMBOL] as Y.Map<T>;\r\n}\r\n\r\nexport function getInternalArray<T>(object: CRDTArray<T>) {\r\n  return object[INTERNAL_SYMBOL] as Y.Array<T>;\r\n}\r\n\r\nexport function getInternalAny(\r\n  object: any /*CRDTArray<any> | CRDTObject<any>*/\r\n): CRDTArray<any> | CRDTObject<any> | undefined {\r\n  return object[INTERNAL_SYMBOL];\r\n}\r\n\r\nexport function crdtValue<T extends NestedSchemaType>(\r\n  value: T | Y.Array<any> | Y.Map<any>,\r\n  parent: T | Y.Array<any> | Y.Map<any>\r\n) {\r\n  value = (getInternalAny(value as any) as any) || value; // unwrap\r\n  if (value instanceof Y.Array) {\r\n    if (parent && parent !== value.parent) {\r\n      // parent has changed = moved\r\n      return crdtArray(value.toJSON()); // create new yarray since yjs does not allow moving an already inserted type, probably breaks updates that come in to the original value after the move has been done on another client\r\n    } else {\r\n      return crdtArray([], value);\r\n    }\r\n  } else if (value instanceof Y.Map) {\r\n    if (parent && parent !== value.parent) {\r\n      // parent has changed = moved\r\n      return crdtObject(value.toJSON()); // create new ymap since yjs does not allow moving an already inserted type, probably breaks updates that come in to the original value after the move has been done on another client\r\n    } else {\r\n      return crdtObject({}, value);\r\n    }\r\n  } else if (typeof value === \"string\") {\r\n    return value; // TODO\r\n  } else if (Array.isArray(value)) {\r\n    return crdtArray(value as any[]);\r\n  } else if (\r\n    value instanceof Y.XmlElement ||\r\n    value instanceof Y.XmlFragment ||\r\n    value instanceof Y.XmlText ||\r\n    value instanceof Y.XmlHook\r\n  ) {\r\n    return value;\r\n  } else if (value instanceof Y.Text) {\r\n    return value;\r\n  } else if (typeof value === \"object\") {\r\n    if (value instanceof Box) {\r\n      return value;\r\n    } else {\r\n      return crdtObject(value as any);\r\n    }\r\n  } else if (typeof value === \"number\" || typeof value === \"boolean\") {\r\n    return value;\r\n  } else {\r\n    throw new Error(\"invalid\");\r\n  }\r\n}\r\n\r\nexport function crdt<T extends ObjectSchemaType>(doc: Y.Doc) {\r\n  return crdtObject({} as T, doc.getMap(\"data\"));\r\n}\r\n\r\nexport type NestedSchemaType = JSONValue | ObjectSchemaType | Box<any> | Y.AbstractType<any> | NestedSchemaType[];\r\n\r\nexport type ObjectSchemaType = {\r\n  [key: string]: NestedSchemaType;\r\n};\r\n\r\nexport { Y };\r\n","import { $reactive, $reactiveproxy } from \"@reactivedata/reactive\";\r\nimport * as Y from \"yjs\";\r\nimport { crdtValue, getInternalAny, INTERNAL_SYMBOL, ObjectSchemaType } from \".\";\r\nimport { parseYjsReturnValue, yToWrappedCache } from \"./internal\";\r\nimport { CRDTObject } from \"./object\";\r\nimport { Box } from \"./boxed\";\r\nimport { isYType } from \"./types\";\r\nimport { vueRef } from \"@reactivedata/yjs-reactive-bindings\";\r\n\r\nexport type CRDTArray<T> = {\r\n  [INTERNAL_SYMBOL]?: Y.Array<T>;\r\n  [n: number]: T extends Box<infer A>\r\n    ? A\r\n    : T extends Array<infer A>\r\n    ? CRDTArray<A>\r\n    : T extends ObjectSchemaType\r\n    ? CRDTObject<T>\r\n    : T;\r\n} & T[]; // TODO: should return ArrayImplementation<T> on getter\r\n\r\nfunction arrayImplementation<T>(arr: Y.Array<T>) {\r\n  const slice = function slice() {\r\n    let ic = this[$reactiveproxy]?.implicitObserver;\r\n    (arr as any)._implicitObserver = ic;\r\n    const items = arr.slice.bind(arr).apply(arr, arguments);\r\n    return items.map(item => {\r\n      const ret = parseYjsReturnValue(item, ic);\r\n      return ret;\r\n    });\r\n  } as T[][\"slice\"];\r\n  const wrapItems = function wrapItems(items) {\r\n    return items.map(item => {\r\n      const wrapped = crdtValue(item as any, arr); // TODO\r\n      const internal = getInternalAny(wrapped) || wrapped;\r\n      if (internal instanceof Box) {\r\n        return internal.value;\r\n      } else {\r\n        return internal;\r\n      }\r\n    });\r\n  };\r\n\r\n  const ret = {\r\n    // get length() {\r\n    //   return arr.length;\r\n    // },\r\n    // set length(val: number) {\r\n    //   throw new Error(\"set length of yjs array is unsupported\");\r\n    // },\r\n    slice,\r\n    unshift: arr.unshift.bind(arr) as Y.Array<T>[\"unshift\"],\r\n    push: (...items: T[]) => {\r\n      arr.push(wrapItems(items));\r\n      return arr.length;\r\n    },\r\n\r\n    insert: arr.insert.bind(arr) as Y.Array<T>[\"insert\"],\r\n    toJSON: arr.toJSON.bind(arr) as Y.Array<T>[\"toJSON\"],\r\n\r\n    forEach: function() {\r\n      return [].forEach.apply(slice.apply(this), arguments);\r\n    } as T[][\"forEach\"],\r\n\r\n    filter: function() {\r\n      return [].filter.apply(slice.apply(this), arguments);\r\n    } as T[][\"filter\"],\r\n\r\n    find: function() {\r\n      return [].find.apply(slice.apply(this), arguments);\r\n    } as T[][\"find\"],\r\n\r\n    map: function() {\r\n      return [].map.apply(slice.apply(this), arguments);\r\n    } as T[][\"map\"],\r\n\r\n    indexOf: function() {\r\n      // check if arg is a vue reactive object and convert toRaw so that indexOf in vue works as expected\r\n      return [].indexOf.apply(slice.apply(this), [\r\n        vueRef && vueRef.isReactive(arguments[0]) ? vueRef.toRaw(arguments[0]) : arguments[0],\r\n        arguments[1]\r\n      ]);\r\n    } as T[][\"indexOf\"],\r\n\r\n    splice: function() {\r\n      let start = arguments[0] < 0 ? arr.length - Math.abs(arguments[0]) : arguments[0];\r\n      let deleteCount = arguments[1];\r\n      let items = Array.from(Array.from(arguments).slice(2));\r\n      let deleted = slice.apply(this, [start, Number.isInteger(deleteCount) ? start + deleteCount : undefined]);\r\n      arr.delete(start, deleteCount);\r\n      arr.insert(start, wrapItems(items));\r\n      return deleted;\r\n    } as T[][\"splice\"]\r\n    // toJSON = () => {\r\n    //   return this.arr.toJSON() slice();\r\n    // };\r\n    // delete = this.arr.delete.bind(this.arr) as (Y.Array<T>)[\"delete\"];\r\n  };\r\n\r\n  // this is necessary to prevent errors like \"trap reported non-configurability for property 'length' which is either non-existent or configurable in the proxy target\" when adding support for ownKeys and Reflect.keysx\r\n  Object.defineProperty(ret, \"length\", {\r\n    enumerable: false,\r\n    configurable: false,\r\n    writable: true,\r\n    value: arr.length\r\n  });\r\n\r\n  return ret;\r\n}\r\n\r\nfunction propertyToNumber(p: string | number | symbol) {\r\n  if (typeof p === \"string\" && p.trim().length) {\r\n    const asNum = Number(p);\r\n    // https://stackoverflow.com/questions/10834796/validate-that-a-string-is-a-positive-integer\r\n    if (Number.isInteger(asNum)) {\r\n      return asNum;\r\n    }\r\n  }\r\n  return p;\r\n}\r\n\r\nexport function crdtArray<T>(initializer: T[], arr = new Y.Array<T>()) {\r\n  if (arr[$reactive]) {\r\n    throw new Error(\"unexpected\");\r\n    // arr = arr[$reactive].raw;\r\n  }\r\n  const implementation = arrayImplementation(arr);\r\n\r\n  const proxy = new Proxy((implementation as any) as CRDTArray<T>, {\r\n    set: (target, pArg, value) => {\r\n      const p = propertyToNumber(pArg);\r\n      if (typeof p !== \"number\") {\r\n        throw new Error();\r\n      }\r\n      // TODO map.set(p, smartValue(value));\r\n      return true;\r\n    },\r\n    get: (target, pArg, receiver) => {\r\n      const p = propertyToNumber(pArg);\r\n\r\n      if (p === INTERNAL_SYMBOL) {\r\n        return arr;\r\n      }\r\n\r\n      if (typeof p === \"number\") {\r\n        let ic: any;\r\n        if (receiver && receiver[$reactiveproxy]) {\r\n          ic = receiver[$reactiveproxy]?.implicitObserver;\r\n          (arr as any)._implicitObserver = ic;\r\n        } else {\r\n          // console.warn(\"no receiver getting property\", p);\r\n        }\r\n        let ret = arr.get(p) as any;\r\n        ret = parseYjsReturnValue(ret, ic);\r\n        return ret;\r\n      }\r\n\r\n      if (p === Symbol.toStringTag) {\r\n        return \"Array\";\r\n      }\r\n\r\n      if (p === Symbol.iterator) {\r\n        const values = arr.slice();\r\n        return Reflect.get(values, p);\r\n      }\r\n\r\n      if (p === \"length\") {\r\n        return arr.length;\r\n      }\r\n      // forward to arrayimplementation\r\n      const ret = Reflect.get(target, p, receiver);\r\n      return ret;\r\n    },\r\n    // getOwnPropertyDescriptor: (target, pArg) => {\r\n    //   const p = propertyToNumber(pArg);\r\n    //   if (typeof p === \"number\" && p < arr.length && p >= 0) {\r\n    //     return { configurable: true, enumerable: true, value: arr.get(p) };\r\n    //   } else {\r\n    //     return undefined;\r\n    //   }\r\n    // },\r\n    deleteProperty: (target, pArg) => {\r\n      const p = propertyToNumber(pArg);\r\n      if (typeof p !== \"number\") {\r\n        throw new Error();\r\n      }\r\n      if (p < arr.length && p >= 0) {\r\n        arr.delete(p);\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    },\r\n    has: (target, pArg) => {\r\n      const p = propertyToNumber(pArg);\r\n      if (typeof p !== \"number\") {\r\n        // forward to arrayimplementation\r\n        return Reflect.has(target, p);\r\n      }\r\n      if (p < arr.length && p >= 0) {\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    },\r\n    getOwnPropertyDescriptor(target, pArg) {\r\n      const p = propertyToNumber(pArg);\r\n      if (p === \"length\") {\r\n        return {\r\n          enumerable: false,\r\n          configurable: false,\r\n          writable: true\r\n        };\r\n      }\r\n      if (typeof p === \"number\" && p >= 0 && p < arr.length) {\r\n        return {\r\n          enumerable: true,\r\n          configurable: true,\r\n          writable: true\r\n        };\r\n      }\r\n      return undefined;\r\n    },\r\n    ownKeys: target => {\r\n      const keys: string[] = [];\r\n      for (let i = 0; i < arr.length; i++) {\r\n        keys.push(i + \"\");\r\n      }\r\n      keys.push(\"length\");\r\n      return keys;\r\n    }\r\n  });\r\n\r\n  implementation.push.apply(proxy, initializer);\r\n  return proxy;\r\n}\r\n","import * as reactive from \"@reactivedata/reactive\";\r\nimport { makeYJSObservable, useReactiveBindings } from \"@reactivedata/yjs-reactive-bindings\";\r\nimport * as Y from \"yjs\";\r\nimport { CRDTArray, crdtArray } from \"./array\";\r\nimport { CRDTObject, crdtObject } from \"./object\";\r\nimport { Box } from \"./boxed\";\r\nimport { JSONValue } from \"./types\";\r\nexport { useMobxBindings, useVueBindings } from \"@reactivedata/yjs-reactive-bindings\";\r\n\r\n// setup yjs-reactive-bindings\r\nmakeYJSObservable();\r\nuseReactiveBindings(reactive); // use reactive bindings by default\r\n\r\nexport const INTERNAL_SYMBOL = Symbol(\"INTERNAL_SYMBOL\");\r\n\r\nexport function getInternalMap<T extends ObjectSchemaType>(object: CRDTObject<T>) {\r\n  return object[INTERNAL_SYMBOL] as Y.Map<T>;\r\n}\r\n\r\nexport function getInternalArray<T>(object: CRDTArray<T>) {\r\n  return object[INTERNAL_SYMBOL] as Y.Array<T>;\r\n}\r\n\r\nexport function getInternalAny(\r\n  object: any /*CRDTArray<any> | CRDTObject<any>*/\r\n): CRDTArray<any> | CRDTObject<any> | undefined {\r\n  return object[INTERNAL_SYMBOL];\r\n}\r\n\r\nexport function crdtValue<T extends NestedSchemaType>(\r\n  value: T | Y.Array<any> | Y.Map<any>,\r\n  parent: T | Y.Array<any> | Y.Map<any>\r\n) {\r\n  value = (getInternalAny(value as any) as any) || value; // unwrap\r\n  if (value instanceof Y.Array) {\r\n    if (parent && parent !== value.parent) {\r\n      // parent has changed = moved\r\n      return crdtArray(value.toJSON()); // create new yarray since yjs does not allow moving an already inserted type, probably breaks updates that come in to the original value after the move has been done on another client\r\n    } else {\r\n      return crdtArray([], value);\r\n    }\r\n  } else if (value instanceof Y.Map) {\r\n    if (parent && parent !== value.parent) {\r\n      // parent has changed = moved\r\n      return crdtObject(value.toJSON()); // create new ymap since yjs does not allow moving an already inserted type, probably breaks updates that come in to the original value after the move has been done on another client\r\n    } else {\r\n      return crdtObject({}, value);\r\n    }\r\n  } else if (typeof value === \"string\") {\r\n    return value; // TODO\r\n  } else if (Array.isArray(value)) {\r\n    return crdtArray(value as any[]);\r\n  } else if (\r\n    value instanceof Y.XmlElement ||\r\n    value instanceof Y.XmlFragment ||\r\n    value instanceof Y.XmlText ||\r\n    value instanceof Y.XmlHook\r\n  ) {\r\n    return value;\r\n  } else if (value instanceof Y.Text) {\r\n    return value;\r\n  } else if (typeof value === \"object\") {\r\n    if (value instanceof Box) {\r\n      return value;\r\n    } else {\r\n      return crdtObject(value as any);\r\n    }\r\n  } else if (typeof value === \"number\" || typeof value === \"boolean\") {\r\n    return value;\r\n  } else {\r\n    throw new Error(\"invalid\");\r\n  }\r\n}\r\n\r\nexport function crdt<T extends ObjectSchemaType>(doc: Y.Doc) {\r\n  return crdtObject({} as T, doc.getMap(\"data\"));\r\n}\r\n\r\nexport type NestedSchemaType = JSONValue | ObjectSchemaType | Box<any> | Y.AbstractType<any> | NestedSchemaType[];\r\n\r\nexport type ObjectSchemaType = {\r\n  [key: string]: NestedSchemaType;\r\n};\r\n\r\nexport { Y };\r\n"],"names":["Box","value","boxed","Object","freeze","isYType","element","Y","AbstractType","yToWrappedCache","WeakMap","parseYjsReturnValue","implicitObserver","_implicitObserver","Array","Map","has","wrapped","crdtValue","set","get","XmlElement","XmlFragment","XmlText","XmlHook","Text","markRaw","__v_skip","Error","crdtObject","initializer","map","$reactive","proxy","Proxy","target","p","internal","getInternalAny","receiver","INTERNAL_SYMBOL","Reflect","ic","$reactiveproxy","ret","deleteProperty","delete","getOwnPropertyDescriptor","enumerable","configurable","undefined","ownKeys","from","keys","key","makeYJSObservable","useReactiveBindings","reactive","Symbol","object","parent","crdtArray","toJSON","isArray","arrayImplementation","arr","slice","items","bind","apply","arguments","item","wrapItems","unshift","push","length","insert","forEach","filter","find","indexOf","vueRef","isReactive","toRaw","splice","start","Math","abs","deleteCount","deleted","Number","isInteger","defineProperty","writable","propertyToNumber","trim","asNum","implementation","pArg","toStringTag","iterator","values","i","getInternalMap","getInternalArray","crdt","doc","getMap"],"mappings":"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"}